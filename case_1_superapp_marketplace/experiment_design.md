# Experiment Design — Supperapp Marketplace Removal

## 1. Контекст и постановка задачи

Суперапп объединяет несколько продуктовых вертикалей, включая такси и маркетплейс.
Основная ценность приложения для большинства пользователей — заказ такси.

Существует продуктовая гипотеза, что наличие маркетплейса в интерфейсе:
- увеличивает когнитивную нагрузку;
- усложняет навигацию;
- снижает фокус пользователей на основной услуге.

Цель эксперимента — количественно оценить влияние удаления маркетплейса
из интерфейса на поведение пользователей и ключевые бизнес-метрики.

---

## 2. Гипотезы

### Нулевая гипотеза (H₀)
Удаление маркетплейса из интерфейса супераппа
не влияет на вовлечённость пользователей в заказ такси.

### Альтернативная гипотеза (H₁)
Удаление маркетплейса из интерфейса супераппа
изменяет вовлечённость пользователей в заказ такси.

Тип гипотезы: двусторонняя
Уровень значимости: α = 0.05

---

## 3. Тип эксперимента и варианты

### Тип эксперимента
A/B/n эксперимент.

### Варианты
- **A — Control**  
  Текущая версия приложения, маркетплейс полностью доступен и промотируется.

- **B — Marketplace Hidden**  
  Маркетплейс полностью скрыт из навигации (вкладки, баннеры, CTA).

- **C — Marketplace De-promoted**  
  Маркетплейс доступен, но удалены все промо-элементы и баннеры.

Дизайн позволяет разделить эффект:
- снижения интерфейсного шума;
- полного отсутствия маркетплейса.

---

## 4. Выборка и сегментация

### Критерии включения
- пользователи с ≥1 оплаченной поездкой такси за последние 90 дней;
- ≥1 сессии за последние 30 дней.

### Критерии исключения
- тестовые и внутренние аккаунты;
- корпоративные и партнёрские аккаунты;
- подозрительная или бот-активность;
- пользователи без юридического согласия (при необходимости).

---

## 5. Unit, рандомизация и сплит

### Unit of randomization
`user_id`.

Рандомизация на уровне пользователя необходима для:
- сохранения консистентного опыта между сессиями;
- корректного измерения долгосрочных эффектов.

### Механика назначения
Детерминированное назначение на основе хеша:
- hash(user_id + salt) → variant
- salt фиксирован и не меняется во время эксперимента;
- assignment стабилен между платформами (iOS / Android / Web).

### Сплит
- A/B: 50% / 50%
- A/B/C: 34% / 33% / 33%

---

## 6. Проверка баланса и стратификация

### Post-hoc проверка баланса
После рандомизации проверяется эквивалентность групп по baseline-метрикам:
- trips per user;
- ARPU;
- sessions per user;
- marketplace orders per user.

При значимых различиях:
- применяется стратификация;
- либо CUPED с историческими ковариатами.

### Возможные страты
- уровень активности в такси (low / medium / high);
- активность в маркетплейсе;
- платформа (iOS / Android);
- регион.

---

## 7. Контроль утечки (contamination)

### Потенциальная проблема
Пользователь может:
- не видеть изменение;
- обходить ограничения через web;
- использовать несколько платформ.

### Exposure-метрики
- доля пользователей, реально столкнувшихся с изменением;
- доля пользователей, получивших доступ к маркетплейсу через альтернативные каналы.

### Подход
- основной анализ — ITT;
- per-protocol анализ — вспомогательный;
- при утечке >20% — эксперимент считается невалидным.

---

## 8. Метрики

### 8.1 Primary-метрика
Доля пользователей, совершивших ≥1 оплаченный заказ такси
в течение 30 дней после попадания в эксперимент.

- Unit of analysis: user_id
- Тип: бинарная
- Анализ: ITT, Z-test или bootstrap CI
- Опционально: CUPED с baseline-метрикой активности

---

### 8.2 Guardrail-метрики
Используются для предотвращения деградации бизнеса:

- ARPU платформы;
- uninstall rate (30 дней);
- GMV маркетплейса;
- количество обращений в поддержку;
- total revenue.

Пороговые значения согласуются с бизнесом до запуска теста.

---

### 8.3 Informative-метрики
Используются для интерпретации эффекта:

- CTR на карточку такси;
- click-to-pay conversion;
- sessions per user;
- time in app;
- exposure-метрики.

---

## 9. Pre-test проверки

Перед запуском эксперимента необходимо:
- убедиться в корректности логирования assignment;
- проверить баланс baseline-метрик;
- протестировать rollback и kill-switch;
- убедиться в отсутствии крупных промо или сезонных аномалий.

Опционально проводится A/A тест для проверки платформы экспериментов.

---

## 10. Вызревание метрик

- 7–14 дней: краткосрочные поведенческие эффекты;
- 4–8 недель: изменение привычек и retention;
- 30–90 дней: экосистемные и cross-sell эффекты.

Выводы делаются только после достижения зрелости ключевых метрик.

---

## 11. Длительность эксперимента

- Минимальная: 4–6 недель;
- Рекомендуемая: 8–12 недель;
- При малом ожидаемом эффекте — до 3 месяцев.

---

## 12. Критерии принятия решения

- Primary ↑ и guardrail стабильны → rollout;
- Primary ↑, guardrail ↓ → частичный rollout или доработка;
- Primary без эффекта → изменение не выкатывается.

---

## 13. Следующие шаги

- Анализ сегментов и гетерогенности эффекта;
- Тест персонализированной навигации;
- Сегментный rollout (heavy taxi users);
- Долгосрочный анализ retention и LTV.
